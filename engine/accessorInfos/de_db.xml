<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>

<accessorInfo>
<xml_file_version type="publictransport" version="1.0" />

<name lang="en">Germany (german railway)</name>
<name lang="de">Deutschland (Deutsche Bahn)</name>

<description lang="en">This service provider works for cities in Germany and also for many other cities in Europe. Cities in Germany include trams, buses, subways, interurban trains and other trains, while cities in other countries may only include trains. Delays are rounded to five minute steps (there's currently no way to get delays with minute accuracy). A delay between zero and four minutes isn't shown, five to nine minutes delay are shown as five minutes dealy and so on.</description>
<description lang="de">Dieser Service-Provider liefert Ergebnisse für Städte in Deutschland und auch für viele andere Städte in Europa. Für Städte in Deutschland enthalten die Ergebnisse Straßenbahnen, Busse, U-Bahnen, regionalen Zugverkehr und andere Züge, während die Städte in anderen Ländern nur Züge enthalten. Verzögerungen sind auf fünf Minuten gerundet (es gibt derzeit keine Möglichkeit Verzögerungen mit Minuten-Genauigkeit zu erhalten). Eine Verzögerung zwischen null und vier Minuten wird nicht angezeigt, fünf bis neun Minuten Verzögerung werden als fünf Minuten Verzögerung angezeigt und so weiter. </description>

<author> <fullname>Friedrich Pülz</fullname> <email>fpuelz@gmx.de</email> </author>
<version>1.1</version>
<type>HTML</type>
<!-- <country>Germany</country> -->
<!-- <cities><city></city></cities> -->
<useSeperateCityValue>false</useSeperateCityValue>

<url>http://reiseauskunft.bahn.de/bin/query.exe/d</url>
<shortUrl>db.de</shortUrl>

<rawUrls>
    <!--  TODO: 	"?" after the stop name => force possible stop list
				"!" after stop name => force no ambiguities -->
    <departures><![CDATA[http://reiseauskunft.bahn.de/bin/bhftafel.exe/dn?rt=1&input={stop}&boardType={dataType}&time={time}&disableEquivs=no&maxJourneys={maxDeps}&start=yes&GUIREQProduct_0&GUIREQProduct_1&GUIREQProduct_2&GUIREQProduct_3&GUIREQProduct_4&GUIREQProduct_5&GUIREQProduct_6&GUIREQProduct_7&GUIREQProduct_8]]></departures>

    <journeys><![CDATA[http://reiseauskunft.bahn.de/bin/query.exe/dn?S={startStop}&Z={targetStop}&time={time}&maxJourneys={maxDeps}&start=yes]]></journeys>
</rawUrls>

<regExps>
    <departures>
	<regExp><![CDATA[(?:<tr>\s*<td class="time">)([0-9]{2})(?::)([0-9]{2})(?:</td>\s*<td class="train"><a[^>]*><img src="[^"]*/img/)(.*)(?:_.{3,7}\.\w{3,4}"[^>]*></a></td><td[^>]*>\s*<a[^>]*>\s*)(.*)(?:\s*</a>\s*</td>\s*<td class="route">\s*<span[^>]*>\s*<a[^>]*>\s*)([^<]*)(?:(?:\s*</a>\s*</span>\s*<br />.*</td>\s*<td class="platform">\s*<strong>)([^<]*)(?:</strong><br />\s*[^<]*</td>\s*))?(?:<td class="ris">\s*(.*)\s*</td>)?(?:.*</tr>)]]></regExp>
	<infos>
	    <info>DepartureHour</info> <info>DepartureMinute</info> <info>TypeOfVehicle</info> <info>TransportLine</info> <info>Target</info> <info>Platform</info> <info>JourneyNews</info>
	</infos>
    </departures>

    <journeys>
	<regExp><![CDATA[(?:<tr class="\s*firstrow">\s*<td class="station first\s*">\s*<a [^>]*></a>\s*<div class="resultDep">\s*)([^<]*)(?:\s*</div>\s*</td>\s*<td class="date">[^,]*,?\s*)([0-9]{2}\.[0-9]{2}\.[0-9]{2})(?:\s*</td>\s*<td class="timetx">[^<]*</td>\s*<td class="time">\s*)([0-9]{2})(?::)([0-9]{2})(?:\s*)(?:[^<]*<span style="[^"]*">[^<]*</span>)?(?:\s*</td>\s*<td class="duration[^"]*" rowspan="2">\s*)([0-9]{1,2}:[0-9]{2})(?:\s*</td>\s*<td class="changes[^"]*"[^>]*>\s*)([0-9]*)(?:\s*</td>\s*<td class="products[^"]*"[^>]*>\s*<span[^>]*><a[^>]*>)(?:[^<]*<img src="[^"]*"[^>]*>)?([^<]*)(?:</a></span>\s*</td>\s*<td class="\s*fareStd[^"]*"[^>]*>\s*)(.*)(?:\s*</td><td class="return[^"]*"[^>]*>\s*<a[^>]*>[^<]*</a>\s*</td>\s*</tr>\s*<tr class="\s*last">\s*<td class="[^"]*stationDest">\s*)([^<]*)(?:\s*</td>\s*<td class="date">[^,]*,?\s*)([0-9]{2}\.[0-9]{2}\.[0-9]{2})(?:\s*</td>\s*<td class="timetx">[^<]*</td>\s*<td class="time">\s*)([0-9]{2})(?::)([0-9]{2})(?:\s*)(?:[^<]*<span style="[^"]*">[^<]*</span>)?(?:[^<]*</td>\s*</tr>)]]></regExp>
	<infos>
	    <info>StartStopName</info> <info>DepartureDate</info> <info>DepartureHour</info> <info>DepartureMinute</info> <info>Duration</info> <info>Changes</info> <info>TypesOfVehicleInJourney</info> <info>Pricing</info> <info>TargetStopName</info> <info>ArrivalDate</info> <info>ArrivalHour</info> <info>ArrivalMinute</info>
	</infos>
    </journeys>

    <journeyNews>
	<item>
	    <regExp><![CDATA[(?:<span><span style="[^"]*">ca.&nbsp;)(\d*)(?:&nbsp;Minuten&nbsp;sp&#228;ter</span></span>)"]]></regExp>
	    <infos><info>Delay</info></infos>
	</item>
	<item>
	    <regExp><![CDATA[(?:<span><span style="[^"]*">ca.&nbsp;)(\d*)(?:&nbsp;Minuten&nbsp;sp&#228;ter</span></span>)(?:,<br/><span class="[^"]*">Grund:\s*)([^<]*)(?:</span>)]]></regExp>
	    <infos><info>Delay</info> <info>DelayReason</info></infos>
	</item>
	<item>
	    <regExp><![CDATA[(?:<span><span style="[^"]*">p&#252;nktlich</span></span>)]]></regExp>
	    <infos><info>NoMatchOnSchedule</info></infos>
	</item>
    </journeyNews>

    <possibleStops>
	<item>
	    <regExpRange><![CDATA[(?:<select class="error" id="rplc0" name="input">\s*)(.*)(?:</select>)]]></regExpRange>
	    <regExp><![CDATA[(?:<option value="[^"]+#)([0-9]+)(?:">)([^<]*)(?:</option>)]]></regExp>
	    <infos><info>StopID</info> <info>StopName</info></infos>
	</item>
	<item>
	    <!-- Possible stops for targets of journeys -->
	    <regExpRange><![CDATA[(?:<select class="locInput" name="REQ0JourneyStopsZ0K" id="REQ0JourneyStopsZ0K"\s*>\s*)(.*)(?:</select>)]]></regExpRange>
	    <regExp><![CDATA[(?:<option value="[^"]*">)([^<]*)(?:</option>)]]></regExp>
	    <infos><info>StopName</info></infos>
	</item>
    </possibleStops>
</regExps>
</accessorInfo>
